<html>
  <head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-particle-system-component@1.0.9/dist/aframe-particle-system-component.min.js"></script>
  </head>
  <body>
    <script>
        AFRAME.registerComponent('mortal', {
        schema: {
            xMin: { type: 'number', default: -3 }, // Limite mínimo no eixo X
            xMax: { type: 'number', default: 3 },  // Limite máximo no eixo X
            speed: { type: 'number', default: 2 }, // Velocidade do movimento
            alturaY: { type: 'number', default: 1 }, // Velocidade do movimento
            depth: { type: 'number', default: -2 } // Profundidade do "U" (menor valor de Y)
          },
        init: function () {
          this.time = 0; // Variável para rastrear o tempo acumulado
        },
        tick: function (time, timeDelta) {
          const delta = (timeDelta / 1000) * this.data.speed; // Incremento baseado na velocidade
          this.time += delta;

          // Calculando o progresso do movimento como uma função oscilante suave
          const progress = Math.sin(this.time); // Oscilação suave (vai de -1 a 1)

          // Atualizando a posição do objeto
          const position = this.el.object3D.position;
          const rotation = this.el.object3D.rotation;

          // Eixo X: Oscila entre xMin e xMax
          position.x = this.data.xMin + (progress + 1) / 2 * (this.data.xMax - this.data.xMin);

          // Eixo Y: Cria uma curva suave com formato de "U"
          position.y = this.data.alturaY + (this.data.depth - Math.cos(progress * Math.PI) * Math.abs(this.data.depth));

          if(position.y > 2.5) {
            rotation.z += 0.09;
          } else {rotation.z = 0}
        }
      });

      AFRAME.registerComponent('remada', {
        schema: {
            xMin: { type: 'number', default: -3 }, // Limite mínimo no eixo X
            xMax: { type: 'number', default: 3 },  // Limite máximo no eixo X
            speed: { type: 'number', default: 2 }, // Velocidade do movimento
            alturaY: { type: 'number', default: 1 }, // Velocidade do movimento
            depth: { type: 'number', default: -2 }, // Profundidade do "U" (menor valor de Y)
          },
        init: function () {
          this.time = 0; // Variável para rastrear o tempo acumulado
        },
        tick: function (time, timeDelta) {
          const delta = (timeDelta / 1000) * this.data.speed; // Incremento baseado na velocidade
          this.time += delta;

          // Calculando o progresso do movimento como uma função oscilante suave
          const progress = Math.sin(this.time) ; // Oscilação suave (vai de -1 a 1)

          // Atualizando a posição do objeto
          const position = this.el.object3D.position;
          const rotation = this.el.object3D.rotation;

          // Eixo X: Oscila entre xMin e xMax 
          // 0 4
          console.log(position.y)
          position.x = this.data.xMin + this.data.speed + (progress + 1) / 2 * (this.data.xMax - this.data.xMin);

        }
      });

      AFRAME.registerComponent('jump', {
  schema: {
    height: { type: 'number', default: 1 },  // Altura do pulo
    duration: { type: 'number', default: 1500 },  // Duração do pulo em milissegundos
    extraDrop: { type: 'number', default: 2.5 }  // Queda adicional na descida
  },
  init: function () {
    this.startY = this.el.object3D.position.y;  // Posição inicial no eixo Y
    this.time = 0;  // Tempo acumulado
    this.jumping = true;  // Estado de pulo
  },
  tick: function (time, timeDelta) {
    const position = this.el.object3D.position;

    // Atualizar o tempo acumulado
    this.time += timeDelta;

    // Calcular a progressão do pulo (vai de 0 a 1 e depois de 1 a 0)
    const progress = this.time / this.data.duration;

    if (this.jumping) {
      // Fase de subida e descida do pulo
      if (progress <= 0.5) {
        // Subindo
        position.y = this.startY + this.data.height * Math.sin(progress * Math.PI);
      } else {
        // Descendo
        position.y = this.startY + this.data.height * Math.sin(progress * Math.PI) - this.data.extraDrop * (progress - 0.5) * 2;
      }

      if (progress >= 1) {
        // Quando o ciclo estiver completo, reiniciar
        this.time = 0;  // Reiniciar o tempo
        position.y = this.startY;  // Resetar a posição inicial
        this.jumping = true;
      }
    }
  }
});


      AFRAME.registerComponent('grind', { //11 3
        schema: {
            xMin: { type: 'number', default: -3 }, // Limite mínimo no eixo X
            xMax: { type: 'number', default: 3 },  // Limite máximo no eixo X
            profundidade: { type: 'number', default: 3 },  
            speed: { type: 'number', default: 2 }, // Velocidade do movimento
          },
        init: function () {
          this.time = 0; // Variável para rastrear o tempo acumulado
        },
        tick: function (time, timeDelta) {
          const delta = (timeDelta / 1000) * this.data.speed; // Incremento baseado na velocidade
          this.time += delta;

          // Calculando o progresso do movimento como uma função oscilante suave
          const progress = Math.sin(this.time); // Oscilação suave (vai de -1 a 1)

          // Atualizando a posição do objeto
          const position = this.el.object3D.position;
          const rotation = this.el.object3D.rotation;

          // Eixo X: Oscila entre xMin e xMax
          position.z = this.data.xMin + this.data.profundidade +(progress + 1) / 2 * (this.data.xMax - this.data.xMin);

          if(position.z > 3.5 && position.z < 12) {
            if(position.y >= 1.6) {
              position.y = 1.6
              rotation.y = 90.5
              position.x = 1
            }
            else {
              position.y += 0.09
              position.x += 0.1
            }
          }
          else {
            if(position.y <= 0.6) {
              position.y = 0.6
            } else {
              position.y -= 0.085
            }
            rotation.y = 89.5
            position.x = 2.8
          }

          // Eixo Y: Cria uma curva suave com formato de "U"
       
        }
      });

      AFRAME.registerComponent('person', {
        schema: {
          colorHead: { type: 'string', default: '#FFCC99' }, // Caminho da imagem ou cor
          colorBody: { type: 'color', default: '#0000FF' },
          colorLimbs: { type: 'color', default: '#000000' },
        },

        init: function () {
          // Cabeça
          const head = document.createElement('a-sphere');
          head.setAttribute('radius', '.5');
          head.setAttribute('position', '0 1.75 0');

          // Verifica se o colorHead é um caminho de imagem
          if (this.data.colorHead.startsWith('img/') || this.data.colorHead.startsWith('./') || this.data.colorHead.startsWith('/')) {
            head.setAttribute('material', `src: ${this.data.colorHead}`);
          } else {
            head.setAttribute('color', this.data.colorHead);
          }

          this.el.appendChild(head);

          // Corpo
          const body = document.createElement('a-cylinder');
          body.setAttribute('radius', '0.2');
          body.setAttribute('height', '0.6');
          body.setAttribute('position', '0 1.2 0');
          body.setAttribute('color', this.data.colorBody);
          this.el.appendChild(body);

          // Braço esquerdo
          const leftArm = document.createElement('a-box');
          leftArm.setAttribute('width', '0.1');
          leftArm.setAttribute('height', '0.6');
          leftArm.setAttribute('depth', '0.1');
          leftArm.setAttribute('position', '-0.35 1.4 0');
          leftArm.setAttribute('color', this.data.colorLimbs);
          this.el.appendChild(leftArm);

          // Braço direito
          const rightArm = document.createElement('a-box');
          rightArm.setAttribute('width', '0.1');
          rightArm.setAttribute('height', '0.6');
          rightArm.setAttribute('depth', '0.1');
          rightArm.setAttribute('position', '0.35 1.4 0');
          rightArm.setAttribute('color', this.data.colorLimbs);
          this.el.appendChild(rightArm);

          // Perna esquerda
          const leftLeg = document.createElement('a-box');
          leftLeg.setAttribute('width', '0.15');
          leftLeg.setAttribute('height', '0.6');
          leftLeg.setAttribute('depth', '0.15');
          leftLeg.setAttribute('position', '-0.15 0.6 0');
          leftLeg.setAttribute('color', this.data.colorLimbs);
          this.el.appendChild(leftLeg);

          // Perna direita
          const rightLeg = document.createElement('a-box');
          rightLeg.setAttribute('width', '0.15');
          rightLeg.setAttribute('height', '0.6');
          rightLeg.setAttribute('depth', '0.15');
          rightLeg.setAttribute('position', '0.15 0.6 0');
          rightLeg.setAttribute('color', this.data.colorLimbs);
          this.el.appendChild(rightLeg);
        },
      });

      AFRAME.registerComponent('skate', {
        schema: {
          xMin: { type: 'number', default: -3 }, // Limite mínimo no eixo X
          xMax: { type: 'number', default: 3 },  // Limite máximo no eixo X
          speed: { type: 'number', default: 2 }, // Velocidade do movimento
          depth: { type: 'number', default: -2 } // Profundidade do "U" (menor valor de Y)
        },
        init: function () {
          // Criando a base, rodas e chassi dentro do componente 'skate'
          // Base do skate (plataforma principal)
          this.base = document.createElement('a-box');
          this.base.setAttribute('position', '0 0.1 -3');
          this.base.setAttribute('width', '2');
          this.base.setAttribute('height', '0.1');
          this.base.setAttribute('depth', '0.5');
          this.base.setAttribute('color', '#8B4513');
          this.el.appendChild(this.base);

          // Rodas do skate
          this.createRoda(-0.8, 0, -3.2);
          this.createRoda(0.8, 0, -3.2);
          this.createRoda(-0.8, 0, -2.8);
          this.createRoda(0.8, 0, -2.8);

          // Chassi do skate (parte superior)
          this.chassi = document.createElement('a-box');
          this.chassi.setAttribute('position', '0 0.15 -3');
          this.chassi.setAttribute('width', '2');
          this.chassi.setAttribute('height', '0.01');
          this.chassi.setAttribute('depth', '0.5');
          this.chassi.setAttribute('color', 'black');
          this.el.appendChild(this.chassi);

          this.time = 0; // Variável para rastrear o tempo acumulado
        },

        // Função para criar as rodas
        createRoda: function (x, y, z) {
          const roda = document.createElement('a-cylinder');
          roda.setAttribute('position', `${x} ${y} ${z}`);
          roda.setAttribute('rotation', '90 0 0')
          roda.setAttribute('radius', '0.1');
          roda.setAttribute('height', '0.2');
          roda.setAttribute('color', 'yellow');
          this.el.appendChild(roda);
        },
      });

      AFRAME.registerComponent('corrimao', {
        schema: {
        },
        init: function () {
          // Criando a base, rodas e chassi dentro do componente 'skate'
          // Base do skate (plataforma principal)
          this.base = document.createElement('a-box');
          this.base.setAttribute('position', '0 0.5 -3');
          this.base.setAttribute('width', '5');
          this.base.setAttribute('height', '0.1');
          this.base.setAttribute('depth', '0.1');
          this.base.setAttribute('color', 'gray');
          this.el.appendChild(this.base);

          // Chassi do skate (parte superior)
          this.createCorrimao(2.45, 0, -3)
          this.createCorrimao(-2.45, 0, -3)

          this.time = 0; // Variável para rastrear o tempo acumulado
        },

        // Função para criar as rodas
        createCorrimao: function (x, y, z) {
          const corrimao = document.createElement('a-box');
          corrimao.setAttribute('position', `${x} ${y} ${z}`);
          corrimao.setAttribute('rotation', '0 0 90')
          corrimao.setAttribute('radius', '0.1');
          corrimao.setAttribute('height', '0.1');
          corrimao.setAttribute('width', '1');
          corrimao.setAttribute('depth', '0.1');
          corrimao.setAttribute('color', 'gray');
          this.el.appendChild(corrimao);
        },
      });
    </script>

    <a-scene physics>
    <a-entity position="0 1 -2.2" skate mortal="xMin: -5.6; xMax:5.6; speed:1.5; alturaY: 0.6; depth: 1.5">
      <a-entity person="colorHead: img/rosto.png;" position="0 -0.1 -3" ></a-entity>
    </a-entity>

    <a-entity position="2.8 0.6 0" rotation="0 90 0" skate grind="xMin: -6.4; xMax:6.5; speed:1.5; profundidade: 7.5">
      <a-entity person="colorHead: img/rosto.png;" position="0 -0.1 -3" ></a-entity>
    </a-entity>

    <a-box position="2.8 1 13" height="2" material="src:img/caixa-jbl.png" animation="property: scale; dir: alternate; dur: 100; to: 1.1 1.1 1.1; loop: true">
      <a-sound src="musica/dingo-bel.mp3" autoplay="true" loop="true" volume="0.3" volume="2d"></a-sound>
    </a-box>

    <a-entity position="2.7 1 8" rotation="0 90 0" corrimao ></a-entity>

    <a-box position="0 0.25 1"
      rotation="0 90 0" material="src:img/pista-quarter.jpg" width="50" height="0.5" depth="20"></a-box>

      <!-- Base da Rampa -->
      <a-box position="0 0.25 -5" material="src:img/pista-quarter.jpg" width="6" height="0.5" depth="4"></a-box>

      <!-- Lado Esquerdo da Rampa -->
      <a-box position="-3.2 1 -5" material="src:img/pista-quarter.jpg" width="0.5" height="2" depth="4"  rotation="0 0 45"></a-box>

      <!-- Lado Direito da Rampa -->
      <a-box position="3.2 1 -5" material="src:img/pista-quarter.jpg" width="0.5" height="2" depth="4" rotation="0 0 -45"></a-box>

      <a-box position="0 0.25 -5" material="src:img/pista-quarter.jpg" width="6" height="0.5" depth="4"></a-box>

      <a-box position="0 1 -8" height="2" material="src:img/caixa-jbl.png" animation="property: scale; dir: alternate; dur: 100; to: 1.1 1.1 1.1; loop: true">
        <a-sound src="musica/charlie-brown.mp3" autoplay="true" loop="true" volume="0.8" volume="2d"></a-sound>
      </a-box>

      <!--ESCADA-->
      <a-entity position="0 3 20" remada="xMin:-2; xMax:6.5; speed:2" jump person="colorHead: img/rosto.png;">
        <a-entity position="0 0.1 3" skate >
      </a-entity>
      </a-entity>
      <a-box position="0 1 20" material="src:img/pista-quarter.jpg" height="2.5" width="3" depth="3"></a-box>
      <a-box position="1 1 20" material="src:img/pista-quarter.jpg" height="1.5" width="3" depth="3"></a-box>
      <a-box position="2 1 20" material="src:img/pista-quarter.jpg" height="1" width="3" depth="3"></a-box>
      <a-box position="3 0.5 20" material="src:img/pista-quarter.jpg" height="1" width="3" depth="3"></a-box>


      <a-plane rotation="-90 0 0" width="1000" height="1000" material="src:img/chao.png"  height="10" ></a-plane>
      <a-sky material="src:img/pista.jpg" ></a-sky>

  </body>
</html>